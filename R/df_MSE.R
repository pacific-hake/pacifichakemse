#' Sum spatial and seasonal data into a data frame
#'
#' @param x list of data
#' @param idx which index to sum over
#'
#' @return returns list as data frame
#' @export
#'
#' @examples
#' \dontrun{
#' catchtmp.country <- map(df.MSE[names(df.MSE) == 'Catch'],.f = fnsum, idx = c(2,3))
#' }
fnsum <- function(x, idx){
  apply(x, MARGIN = idx, sum)
}

#' Turn whole list into a concatenated polished data frame
#'
#' @param df.MSE MSE that contains the data
#' @param id object to extract
#' @param idx which indexes to save to
#' @param spacenames naming convention for spatial areas
#' @param runs number of runs in MSE
#' @param nspace number of spaces
#'
#' @return returns a concatenated data frame
#' @importFrom purrr map
#' @export
#' @examples
#' \dontrun{
#' processMSE(test) # not run
#' }
processMSE <- function(df.MSE,
                       id,
                       idx = 1,
                       spacenames = c('CAN','USA'),
                       runs = 100,
                       nspace = 2){

tmp <- lapply(map(df.MSE[names(df.MSE) == id],
                  .f = fnsum, idx = idx),
              data.frame, stringsAsFactors = FALSE)

if(length(idx) == 1){
tmp <- lapply(tmp, setNames, nm = 'value')
}

if(length(idx) > 1){
  tmp <- lapply(tmp, setNames, spacenames)
}


yrs <- as.numeric(rownames(tmp[[1]]))

names(tmp) <- paste('run',1:runs, sep = '')

tmp.df <- data.table::rbindlist(tmp, idcol = 'run')
tmp.df$year <- rep(yrs, runs)

if(length(idx) > 1){
  tmp.df <- reshape2::melt(tmp.df, measure.vars = spacenames, variable.name = 'space')
}


return(tmp.df)
}

